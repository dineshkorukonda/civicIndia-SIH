generator client {
  provider = "prisma-client-js"
  output   = "../src/generated/prisma"
}

datasource db {
  provider = "mysql"
  url      = env("DATABASE_URL")
}

model User {
  id              Int          @id @default(autoincrement())
  name            String
  email           String       @unique
  password        String
  role            String       @default("user")
  isActive        Boolean      @default(true)
  createdAt       DateTime     @default(now())
  updatedAt       DateTime     @updatedAt
  availablePoints Int          @default(0)
  totalPoints     Int          @default(0)
  points          Point[]
  reports         Report[]
  coupons         Coupon[]
  contractor      Contractor?  // One-to-one relation with Contractor

  @@map("users")
}

model Report {
  id            Int      @id @default(autoincrement())
  lat           Float
  lng           Float
  imageUrl      String
  issueType     String
  severity      Float
  description   String?  @db.Text
  status        String   @default("pending")
  assignedTo    String?
  createdAt     DateTime @default(now())
  updatedAt     DateTime @updatedAt
  userId        Int
  pointsAwarded Int      @default(0)
  avgTimeToFix  Int      @default(0)
  user          User     @relation(fields: [userId], references: [id])

  @@index([userId], map: "reports_userId_fkey")
  @@map("reports")
}

model Point {
  id          Int      @id @default(autoincrement())
  userId      Int
  type        String
  amount      Int
  description String
  reportId    Int?
  createdAt   DateTime @default(now())
  user        User     @relation(fields: [userId], references: [id])

  @@index([userId], map: "points_userId_fkey")
  @@map("points")
}

model Coupon {
  id          Int      @id @default(autoincrement())
  userId      Int
  brand       String   // swiggy, zomato, flipkart, amazon
  couponCode  String   @unique
  value       Int      // Value in rupees
  pointsCost  Int      // Points required to redeem
  status      String   @default("active") // active, used, expired
  redeemedAt  DateTime @default(now())
  usedAt      DateTime?
  expiresAt   DateTime
  user        User     @relation(fields: [userId], references: [id])

  @@index([userId], map: "coupons_userId_fkey")
  @@map("coupons")
}

model Contractor {
  id          Int      @id @default(autoincrement())
  name        String
  email       String   @unique
  phone       String
  userId      Int?     @unique // Link to User account for login
  address     String?  @db.Text
  city        String?
  state       String?
  zipCode     String?
  latitude    Float?
  longitude   Float?
  company     String?
  status      String   @default("active") // active, inactive, suspended
  rating      Float?   @default(0)
  totalJobs   Int      @default(0)
  completedJobs Int    @default(0)
  isAvailable Boolean  @default(true)
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
  user        User?    @relation(fields: [userId], references: [id])

  @@index([userId], map: "contractors_userId_fkey")
  @@map("contractors")
}
